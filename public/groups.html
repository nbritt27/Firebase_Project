<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Groups</title>
    <link rel="stylesheet" href="resetstyle.css">
    <link rel="stylesheet" href="groups.css">
    <script src="https://www.gstatic.com/firebasejs/3.6.4/firebase.js"></script>
    <script>
            // Initialize Firebase
            var config = {
              apiKey: "AIzaSyDsmkVyaN9_BhUnzUjqtilAM8FDr1Ccndo",
              authDomain: "test-project-a8dd5.firebaseapp.com",
              databaseURL: "https://test-project-a8dd5.firebaseio.com",
              projectId: "test-project-a8dd5",
              storageBucket: "test-project-a8dd5.appspot.com",
              messagingSenderId: "1066619119347"
            };
            firebase.initializeApp(config);
          </script>
     <script type="text/javascript">
       var userRef;
       initApp = function() {
         firebase.auth().onAuthStateChanged(function(user) {
           if (user) {
             // User is signed in.
             userRef=user;

             var database=firebase.database();
             var displayName = user.displayName;
             this.userPic = document.getElementById('user-pic');

             var email = user.email;
             var emailVerified = user.emailVerified;
             var photoURL = user.photoURL;
             var uid = user.uid;
             var phoneNumber = user.phoneNumber;
             var providerData = user.providerData;
             var userAge=user.age;
             var userBio=user.bio
             this.userPic.src = photoURL;
             database.ref().child('users'+uid).set({
             username: displayName,
             email: email,
             profile_picture : photoURL,
             age: userAge,
             bio: userBio
   });
             console.log("Trying to add the data");
             user.getIdToken().then(function(accessToken) {
               document.getElementById('sign-in-status').textContent = 'Signed in';
               document.getElementById('sign-in').textContent = 'Sign out';
               document.getElementById('account-details').textContent = JSON.stringify({
                 displayName: displayName,
                 email: email,
                 emailVerified: emailVerified,
                 phoneNumber: phoneNumber,
                 photoURL: photoURL,
                 uid: uid,
                 accessToken: accessToken,
                 providerData: providerData
               }, null, '  ');
             });


           } else {
             // User is signed out.
             document.getElementById('sign-in-status').textContent = 'Signed out';
             document.getElementById('sign-in').textContent = 'Sign in';
             document.getElementById('account-details').textContent = 'null';
           }
         }, function(error) {
           console.log(error);
         });
       };

       window.addEventListener('load', function() {
         initApp();
         loadGroups();
       });
       function loadGroups(){
            console.log("running loadFeed");
            removeGroupNodes();
            //var postContainer = document.getElementById("groupContainer");

            var leadsRef = firebase.database().ref().child('groups');
              leadsRef.on('value', function(snapshot) {
              removeGroupNodes();
              var groupContainer=document.createElement('div');
              groupContainer.id="groupContainer";
              snapshot.forEach(function(childSnapshot) {
              var childData = childSnapshot.val();
              //console.log(childData);

              var groupDiv=document.createElement('div');
                groupDiv.id="groupDiv";
                //var userInfo = document.createElement("div");
                //userInfo.id = "userInfo";
                //groupDiv.appendChild(userInfo);
                //var postData = document.createElement("div");
                //postData.id = "postData";
                //var userPicture=document.createElement("img");
                //userPicture.id="user-feed-pic";
                //userPicture.src=childData["picturesrc"];
                //userInfo.appendChild(userPicture);
                var groupName=document.createElement("h1");
                groupName.id="userLabel";
                groupName.innerHTML=childData["title"];
                groupDiv.appendChild(groupName);
                //var titleText=document.createElement("h1");
                //titleText.id="titleElement";
                //titleText.innerHTML=childData["title"];
                //postData.appendChild(titleText);
                var groupDescription=document.createElement("p");
                groupDescription.id="bodyElement";
                groupDescription.innerHTML=childData["description"];
                groupDiv.appendChild(groupDescription);

                var groupTag=document.createElement("p");
                groupTag.id="groupTag";
                groupTag.innerHTML="@" + childData["tag"];
                groupDiv.appendChild(groupTag);

                var groupJoin=document.createElement("button");
                groupJoin.id="groupJoin";
                groupJoin.innerHTML="Join";
                
                //groupDiv.appendChild(userInfo);
                //groupDiv.appendChild(postData);
                groupContainer.appendChild(groupDiv);
                document.body.appendChild(groupContainer);
            });
          });
          }
          function removeGroupNodes(){
          while(true){
            try{
              document.body.removeChild(document.getElementById("groupContainer"));

            }
            catch(error){
              console.log("found an error");
              break;
            }

          }
          }
     </script>
  </head>
  <body>
    <nav class="nav-login">
            <ul>
                <li><a href="home.html">Home</a></li>
                <li><a href="groups.html">Groups</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="login.html">Profile</a></li>

                <li><div id="firebaseui-auth-container"></div></li>
                <li><div><img id="user-pic" src="https://cdn4.iconfinder.com/data/icons/forum-buttons-and-community-signs-1/794/profile-3-512.png" style="  width: 40px;height: 40px;background-size: 40px;border-radius: 20px; right: 10px; top: 10px;"></div></li>
            </ul>
    </nav>

    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
  </body>
</html>
